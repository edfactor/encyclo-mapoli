
-- FIRST EMPTY OUT THE TABLE
TRUNCATE TABLE TALGER.PROFIT_DETAIL;

 INSERT INTO TALGER.PROFIT_DETAIL
   (PROFIT_YEAR,
    PROFIT_YEAR_ITERATION,
    PROFIT_CODE_ID,
    CONTRIBUTION,
    EARNINGS,
    FORFEITURE,
    ZEROCONT,
    FEDERAL_TAXES,
    STATE_TAXES,
    TAX_CODE_ID,
    SSN,
    DISTRIBUTION_SEQUENCE,
    MONTH_TO_DATE,
    REMARK,
    YEAR_TO_DATE)
SELECT
    TRUNC(PROFIT_YEAR),
    MOD(PROFIT_YEAR * 10, 10),
    PROFIT_CODE,
    PROFIT_CONT,
    PROFIT_EARN,
    PROFIT_FORT,
    PROFIT_ZEROCONT,
    NVL(PROFIT_FED_TAXES,0),
    NVL(PROFIT_STATE_TAXES,0),
    CASE
         WHEN TRIM(PROFIT_TAX_CODE) = '0' THEN NULL
         ELSE TRIM(PROFIT_TAX_CODE)           
    END as ptcode,
    PR_DET_S_SEC_NUMBER,
    PROFIT_DET_PR_DET_S_SEQNUM,
    PROFIT_MDTE,
    CASE
         WHEN TRIM(PROFIT_CMNT) = '' THEN NULL
         ELSE PROFIT_CMNT           
    END as pcmnt,
    CASE 
        WHEN TO_NUMBER(PROFIT_YDTE) >= 59 THEN '19' || PROFIT_YDTE
        ELSE '20' || PROFIT_YDTE
    END AS FOUR_DIGIT_YEAR
FROM MTPR2.PROFIT_DETAIL;